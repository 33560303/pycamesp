<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>lib.server.ftpserver API documentation</title>
<meta name="description" content="Ftp server main class.
This class contains few lines of code, this is to save memory.
The core of the server is in the other class FtpServerCore, â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>lib.server.ftpserver</code></h1>
</header>
<section id="section-intro">
<p>Ftp server main class.
This class contains few lines of code, this is to save memory.
The core of the server is in the other class FtpServerCore, which is loaded into memory only when connecting an FTP client.
It takes a little while the first time you connect, but limits memory consumption if not in use.
If you have enough memory (SPIRAM or other), just start the server with the preload option at True.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># Distributed under MIT License
# Copyright (c) 2021 Remi BERTHOLET
# historically based on :
# https://github.com/robert-hh/FTP-Server-for-ESP8266-ESP32-and-PYBD/blob/master/ftp.py
# but I have modified a lot, there must still be some original functions.
&#34;&#34;&#34; Ftp server main class.
This class contains few lines of code, this is to save memory.
The core of the server is in the other class FtpServerCore, which is loaded into memory only when connecting an FTP client.
It takes a little while the first time you connect, but limits memory consumption if not in use.
If you have enough memory (SPIRAM or other), just start the server with the preload option at True.
&#34;&#34;&#34;
import uasyncio
from tools import logger

class Ftp:
        &#34;&#34;&#34; Ftp main class &#34;&#34;&#34;
        def __init__(self, port=21, preload=False):
                self.server_class = None
                self.port = port
                if preload:
                        self.preload()
                else:
                        logger.syslog(&#34;Ftp waiting on %d&#34;%self.port)

        def preload(self):
                &#34;&#34;&#34; Preload of ftp core class (the core is only loaded if the ftp connection started, save memory) &#34;&#34;&#34;
                if self.server_class is None:
                        logger.syslog(&#34;Ftp load server&#34;)
                        from server.ftpservercore import FtpServerCore
                        self.server_class = FtpServerCore
                        logger.syslog(&#34;Ftp ready on %d&#34;%self.port)

        async def on_connection(self, reader, writer):
                &#34;&#34;&#34; Asynchronous connection detected &#34;&#34;&#34;
                try:
                        # Preload ftp core class
                        self.preload()

                        # Start ftp core
                        server = self.server_class()

                        # Call on connection method
                        await server.on_connection(reader, writer)

                        # Close ftp core
                        server.close()
                        del server
                except Exception as err:
                        logger.syslog(err)

def start(loop=None, port=21, preload=False):
        &#34;&#34;&#34; Start the ftp server with asyncio loop.
        loop : asyncio loop object
        port : tcp/ip port of the server
        preload : True = preload the server at the start, False = load the server at the first connection &#34;&#34;&#34;
        server = Ftp(port, preload)

        # If asyncio loop not created
        if loop is None:
                # Create asyncio loop
                loop = uasyncio.get_event_loop()

                # Run for ever in this case the ftp server
                run_forever = True
        else:
                # The ftp server is called on asyncio connection
                run_forever = False

        # Start ftp server on port specified
        asyncServer = uasyncio.start_server(server.on_connection, &#34;0.0.0.0&#34;, port, backlog=1)

        # Create asyncio task
        loop.create_task(asyncServer)

        # If ftp server is stand alone mode
        if run_forever:
                loop.run_forever()

if __name__ == &#34;__main__&#34;:
        start()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="lib.server.ftpserver.start"><code class="name flex">
<span>def <span class="ident">start</span></span>(<span>loop=None, port=21, preload=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Start the ftp server with asyncio loop.
loop : asyncio loop object
port : tcp/ip port of the server
preload : True = preload the server at the start, False = load the server at the first connection</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start(loop=None, port=21, preload=False):
        &#34;&#34;&#34; Start the ftp server with asyncio loop.
        loop : asyncio loop object
        port : tcp/ip port of the server
        preload : True = preload the server at the start, False = load the server at the first connection &#34;&#34;&#34;
        server = Ftp(port, preload)

        # If asyncio loop not created
        if loop is None:
                # Create asyncio loop
                loop = uasyncio.get_event_loop()

                # Run for ever in this case the ftp server
                run_forever = True
        else:
                # The ftp server is called on asyncio connection
                run_forever = False

        # Start ftp server on port specified
        asyncServer = uasyncio.start_server(server.on_connection, &#34;0.0.0.0&#34;, port, backlog=1)

        # Create asyncio task
        loop.create_task(asyncServer)

        # If ftp server is stand alone mode
        if run_forever:
                loop.run_forever()</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="lib.server.ftpserver.Ftp"><code class="flex name class">
<span>class <span class="ident">Ftp</span></span>
<span>(</span><span>port=21, preload=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Ftp main class</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Ftp:
        &#34;&#34;&#34; Ftp main class &#34;&#34;&#34;
        def __init__(self, port=21, preload=False):
                self.server_class = None
                self.port = port
                if preload:
                        self.preload()
                else:
                        logger.syslog(&#34;Ftp waiting on %d&#34;%self.port)

        def preload(self):
                &#34;&#34;&#34; Preload of ftp core class (the core is only loaded if the ftp connection started, save memory) &#34;&#34;&#34;
                if self.server_class is None:
                        logger.syslog(&#34;Ftp load server&#34;)
                        from server.ftpservercore import FtpServerCore
                        self.server_class = FtpServerCore
                        logger.syslog(&#34;Ftp ready on %d&#34;%self.port)

        async def on_connection(self, reader, writer):
                &#34;&#34;&#34; Asynchronous connection detected &#34;&#34;&#34;
                try:
                        # Preload ftp core class
                        self.preload()

                        # Start ftp core
                        server = self.server_class()

                        # Call on connection method
                        await server.on_connection(reader, writer)

                        # Close ftp core
                        server.close()
                        del server
                except Exception as err:
                        logger.syslog(err)</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="lib.server.ftpserver.Ftp.on_connection"><code class="name flex">
<span>async def <span class="ident">on_connection</span></span>(<span>self, reader, writer)</span>
</code></dt>
<dd>
<div class="desc"><p>Asynchronous connection detected</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">async def on_connection(self, reader, writer):
        &#34;&#34;&#34; Asynchronous connection detected &#34;&#34;&#34;
        try:
                # Preload ftp core class
                self.preload()

                # Start ftp core
                server = self.server_class()

                # Call on connection method
                await server.on_connection(reader, writer)

                # Close ftp core
                server.close()
                del server
        except Exception as err:
                logger.syslog(err)</code></pre>
</details>
</dd>
<dt id="lib.server.ftpserver.Ftp.preload"><code class="name flex">
<span>def <span class="ident">preload</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Preload of ftp core class (the core is only loaded if the ftp connection started, save memory)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def preload(self):
        &#34;&#34;&#34; Preload of ftp core class (the core is only loaded if the ftp connection started, save memory) &#34;&#34;&#34;
        if self.server_class is None:
                logger.syslog(&#34;Ftp load server&#34;)
                from server.ftpservercore import FtpServerCore
                self.server_class = FtpServerCore
                logger.syslog(&#34;Ftp ready on %d&#34;%self.port)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="lib.server" href="index.html">lib.server</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="lib.server.ftpserver.start" href="#lib.server.ftpserver.start">start</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="lib.server.ftpserver.Ftp" href="#lib.server.ftpserver.Ftp">Ftp</a></code></h4>
<ul class="">
<li><code><a title="lib.server.ftpserver.Ftp.on_connection" href="#lib.server.ftpserver.Ftp.on_connection">on_connection</a></code></li>
<li><code><a title="lib.server.ftpserver.Ftp.preload" href="#lib.server.ftpserver.Ftp.preload">preload</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>